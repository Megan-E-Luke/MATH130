---
title: "Lesson 03 - Getting Started with R"
date: "Last Updated `r format(Sys.Date(), '%m-%d-%y')`"
output:
  html_document:
    highlight: tango
    theme: yeti
    css: ../css/yeti.css
    toc: yes
    toc_float: yes
  pdf_document:
    toc: no
---


# Introduction

This lesson is designed to explain the basics of how R works as a programming language. It also introduces
R markdown, a method of writing R code into a literate and reproducible document. 

### Learning Objectives

* Define the following terms as they relate to R: object, assign, call, function, arguments, options.
* Assign values to objects in R.
* Learn how to _name_ objects
* Solve simple arithmetic operations in R.
* Call functions and use arguments to change their default options.
* Inspect the content of vectors and manipulate their content.
* Subset and extract values from vectors.
* Inspect the content of matricies and manipulate their content.
* Subset and extract values from matricies.
* Create a reproducible R Markdown document that integrates written text, R code and output into a literate document.  


---


# Writing Scripts

There are two main ways of interacting with R: by using the console or by using
script files (plain text files that contain your code). 

In the last lesson we saw that we could write R code in the console and get 
immediate results. 

Because we want our code and workflow to be reproducible, and often your code may 
span several lines at a time, it is better to type the commands we want in the 
script editor, and save the script. This way, there is a complete record of what 
we did, and anyone (including our future selves!) can easily replicate the results 
on their computer. It's also easier to fix mistakes this way, without having to
retype in the entire command. 


##### Go to File --> New File --> R Script to open a new R script window.

Let's go back to that long expression (corrected), but this time type it into your 
script editor (top left window) and then press <kbd>`Ctrl`</kbd> + <kbd>`Enter`</kbd>.

```
2 + 5*(8^3)- 3*log(10)
```

##### Make a change to the above expression and run the command again. 


For the rest of this lesson, when asked to try out some code type
it into the script editor and submit it from there. 


----

# Creating objects in R

To do useful and interesting things, we need to assign _values_ to
_objects_. To create an object, we need to give it a name followed by the
assignment operator `<-`, and the value we want to give it:

```{r}
weight_kg <- 55
```

`<-` is the assignment operator. It assigns values on the right to objects on
the left. So, after executing `x <- 3`, the value of `x` is `3`. 

Objects can be given any name such as `x`, `current_temperature`, or `subject_id`. 

* You want your object names to be explicit and not too long. 
* They cannot start with a number (`2x` is not valid, but `x2` is). 
* R is case sensitive (e.g., `weight_kg` is different from `Weight_kg`). 
* There are some names that cannot be used because they are the names of fundamental 
  functions in R (e.g., `if`, `else`, `for`, see
  [here](https://stat.ethz.ch/R-manual/R-devel/library/base/html/Reserved.html)
  for a complete list). 
* It's best to not use other function names (e.g., `c`, `T`, `mean`, `data`, `df`, `weights`)
  because these already tend to be in use by different parts of R. 
* See [Google's](https://google.github.io/styleguide/Rguide.xml) style guide for more information. 

When assigning a value to an object, R does not print anything. You can force R to print the value by using parentheses or by typing the object name:

```{r}
weight_kg <- 55    # doesn't print anything
(weight_kg <- 55)  # but putting parenthesis around the call prints the value of `weight_kg`
weight_kg          # and so does typing the name of the object
```

Now that R has `weight_kg` in memory, we can do arithmetic with it. For
instance, we may want to convert this weight into pounds (weight in pounds is 2.2 times the weight in kg):

```{r}
2.2 * weight_kg
```

We can also change an object's value by assigning it a new one:

```{r}
weight_kg <- 57.5
2.2 * weight_kg
```

This means that assigning a value to one object does not change the values of
other objects  For example, let's store the animal's weight in pounds in a new
object, `weight_lb`:

```{r}
weight_lb <- 2.2 * weight_kg
```

and then change `weight_kg` to 100.

```{r}
weight_kg <- 100
```

What do you think is the current content of the object `weight_lb`? 126.5 or 220?

_**Comments.**_
_The comment character in R is `#`, anything to the right of a `#` in a script will be ignored by R. It is useful to leave notes, and explanations in your scripts as demonstrated earlier._

##### What are the values after each statement in the following?

```r
mass <- 47.5            # mass?
age  <- 122             # age?
mass <- mass * 2.0      # mass?
age  <- age - 20        # age?
mass_index <- mass/age  # mass_index?
```

----

# Functions and their arguments

Functions are "canned scripts" that automate more complicated sets of commands
including operations assignments, etc. Many functions are predefined, or can be
made available by importing R *packages* (more on that later).

A function usually takes one or more inputs called *arguments*, and often (but not
always) return a *value*. 

A typical example would be the function `sqrt()`. The input is the number `4`, and 
the return value (the output) is the square root of 4, namely 2. Executing a function 
('running it') is called *calling* the function. 

```{r}
sqrt(4)
```

Let's look into the `round` function. 

```{r}
round(3.14159)
```

We can learn more about this function by typing `?round`. The **Usage** section of 
the help documentation shows you what the default values for each argument are. This is 
a very important piece to pay attention. Sometimes the default behaviors are not what you want to happen. 

```{r, eval=FALSE}
round(x, digits=0)
```

In the **Arguments** section the help file defines what each argument does.

* `x` is the object that you want to round. It must be a _numeric vector_.
* `digits` is an integer indicating the number of decimal places to round to.

Above, we called `round()` with just one argument, `3.14159`, and it has
returned the value `3`.  That's because the default is to round to the nearest
whole number. We see that if we want a different number of digits, we can
type `digits = 2` or however many we want.

```{r}
round(3.14159, digits = 2)
```

If you provide the arguments in the exact same order as they are defined you
don't have to name them:

```{r}
round(3.14159, 2)
```

And if you do name the arguments, you can switch their order:

```{r}
round(digits = 2, x = 3.14159)
```

This is a simple function with only one argument. Functions are the backbone of how R 
does it's thing. You will get lots of practice with functions, and quickly encounter 
functions that require many arguments. 

----

# Vectors and data types

A vector is the most common and basic data type in R, and is pretty much
the workhorse of R. A vector is composed by a series of values, which can be
either numbers or characters. We can assign a series of values to a vector using
the `c()` function. For example we can create a vector of animal weights and assign
it to a new object `weight_g`:

```{r}
(weight_g <- c(50, 60, 65, 82))
```

A vector can also contain characters:

```{r}
(animals <- c("mouse", "rat", "dog"))
```

The quotes around "mouse", "rat", etc. are essential here. Without the quotes R
will assume objects have been created called `mouse`, `rat` and `dog`. As these objects
don't exist in R's memory, there will be an error message.

An important feature of a vector, is that all of the elements are the same type of data.
The function `class()` indicates the class (the type of element) of an object:

```{r}
class(weight_g)
class(animals)
```

The function `str()` provides an overview of the structure of an object and its
elements. It is a useful function when working with large and complex
objects:

```{r}
str(weight_g)
str(animals)
```

## Data Types

R objects come in different data types. You just saw vectors comprised of numbers (**numeric**), 
of words (**character** or **string**). The other main data types that we will be encountering 
is a `"logical"`. These are created by writing a logical statement where the answer is either TRUE or FALSE. Silly examples include "Is 3 greater than 4?" and "Is the square root of 4 equal to 2?"
```{r}
3>4
sqrt(4)==2
```

We will see how to use these logical statements to do things such as subseting data and creating new variables. 

Vectors are one of the many **data structures** that R uses. Other important
ones are lists (`list`), matrices (`matrix`), data frames (`data.frame`),
factors (`factor`) and arrays (`array`).

## Type coercion (conversion)
Weâ€™ve seen that vectors can be of type character, numeric, and logical. But what happens if we try to mix these types in a single vector?

##### Use the `class()` function to identify tge type of vector for each of these examples. 

```r
num_char <- c(1, 2, 3, "a")
num_logical <- c(1, 2, 3, TRUE)
char_logical <- c("a", "b", "c", TRUE)
tricky <- c(1, 2, 3, "4")
```

# Subsetting vectors

If we want to extract one or several values from a vector, we must provide one
or several indices in square brackets. For instance:

```{r}
animals <- c("mouse", "rat", "dog", "cat")
animals[2]
animals[c(3, 2)]
```

The number in the indicies indicates which element to extract.

##### Extract the 3rd element in `weight_g`.


## Conditional subsetting

Another common way of subsetting is by using a logical vector. `TRUE` will
select the element with the same index, while `FALSE` will not:

```{r}
weight_g <- c(21, 34, 39, 54, 55)
weight_g[c(TRUE, FALSE, TRUE, TRUE, FALSE)]
```

Typically, these logical vectors are not typed by hand, but are the output of
other functions or logical tests. For instance, if you wanted to select only the
values above 50:

```{r}
weight_g > 50    # will return logicals with TRUE for the indices that meet the condition
## so we can use this to select only the values above 50
weight_g[weight_g > 50]
```

You can combine multiple tests using `&` (both conditions are true, AND) or `|`
(at least one of the conditions is true, OR):

```{r}
weight_g[weight_g < 30 | weight_g > 50]
weight_g[weight_g >= 30 & weight_g == 21]
```

Here, `<` stands for "less than", `>` for "greater than", `>=` for "greater than
or equal to", and `==` for "equal to". The double equal sign `==` is a test for
numerical equality between the left and right hand sides, and should not be
confused with the single `=` sign, which performs variable assignment (similar
to `<-`).

A common task is to search for certain strings in a vector.  One could use the
"or" operator `|` to test for equality to multiple values, but this can quickly
become tedious. The function `%in%` allows you to test if any of the elements of
a search vector are found:

```{r}
animals <- c("mouse", "rat", "dog", "cat")
animals[animals == "cat" | animals == "rat"] # returns both rat and cat
animals %in% c("rat", "cat", "dog", "duck", "goat")
animals[animals %in% c("rat", "cat", "dog", "duck", "goat")]
```


##### Can you figure out why `"four" > "five"` returns `TRUE`?

----

# Installing Packages

R is considered an **Open Source** software program. That means many (thousands) of people contribute to the software. They do this by writing commands (called functions) to make a particular analysis easier, or to make a graphic prettier.

When you download R, you get access to a lot of functions that we will use. However these other _user-written_ packages add so much good stuff that it really is the backbone of the customizability and functionality that makes R so powerful of a language. 

For example we will be creating graphics using functions like `boxplot()` and `hist()` that exist in base R. But we will quickly move on to creating graphics using functions contained in the `ggplot2` package. We will be managing data using functions in `dplyr` and reading in Excel files using `readxl`. Installing packages will become your favorite pasttime. 

To get started open R Studio and in the Console type the following command to install the `rmarkdown` package. Hit <kbd>`Enter`</kbd> to submit the command to R and watch the install. 

```r
install.packages("ggplot2")
```

When the console returns to showing a `>` (and the stop sign in the top right corner of the Console window goes away), R is done doing what you asked it to do and ready for you to give it another command. You should get a message that looks similar to the message below. 

```
The downloaded binary packages are in
	C:\Users\Robin\AppData\Local\Temp\Rtmpi8NAym\downloaded_packages
```

Some packages use functions that live in other packages. These are called dependencies and will be automatically installed when you tell R to install a new package. 99% of the time you will not have to install them manually on your own. 


> You only have to install packages once. To access commands within the functions you must load the package first using the code `library(package name)`. We will start to use various packages next week. 


Now that you're a package installing pro, go ahead and install the following packages that we will be using in the next few weeks. Type these commands into the console one at a time, hitting <kbd>`Enter`</kbd> to submit, and waiting for it to finish before entering the next command. **R is case sensitive**.

```r
install.packages("rmarkdown")
install.packages("knitr")
install.packages("forcats")
install.packages("readxl")
install.packages("dplyr")
```

Note in this last package that is a lower case letter L at the end. For read EXCELL. It is not the number 1 (one). 

<span style="color:red">If you see a message such as the one below, check for a typo.</span>

```
Warning in install.packages :
  package â€˜ggplotâ€™ is not available (for R version 3.5.1)
```

The correct package name is `ggplot2`, not `ggplot`.


----

# R Markdown


So far we have only been working with a script file that can only contain comments, and R code itself. 
This has the file extension `.R`. From here on out we will be working in a slightly different file type
called an R Markdown file. This has the file extension `.Rmd` (and often will be referred to as your "rmd file"). 



----

This material is a derivation from work that is Copyright Â© Software Carpentry (http://software-carpentry.org/) which is under a [CC BY 4.0 license](https://creativecommons.org/licenses/by/4.0/) which allows for adaptations and reuse of the work. 
